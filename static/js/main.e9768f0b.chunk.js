(this["webpackJsonpgeolocation-app"]=this["webpackJsonpgeolocation-app"]||[]).push([[0],{49:function(t,e,a){},50:function(t,e,a){},78:function(t,e,a){},79:function(t,e,a){"use strict";a.r(e);var n=a(0),c=a.n(n),o=a(21),s=a.n(o),r=(a(49),a(50),a(15)),i=a(6),l=a(22),u=a(16),j=a(14),b=a.n(j),d=a(18),g=a(12),m=a(20),p=a.n(m),h=a(1),O=function(){var t=Object(n.useState)({latitude:0,longitude:0,email:"",password:""}),e=Object(g.a)(t,2),a=e[0],c=e[1],o=Object(i.f)();Object(n.useEffect)((function(){navigator.geolocation.getCurrentPosition((function(t){c({latitude:t.coords.latitude,longitude:t.coords.longitude})}),(function(t){return console.log(t)}),{enableHighAccuracy:!0})}),[]);var s=function(){var t=Object(d.a)(b.a.mark((function t(){var e;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p.a.post("https://coding-test.rootstack.net/api/auth/login",{email:a.email,password:a.password});case 3:e=t.sent,localStorage.setItem("access_token",e.data.access_token),r(e.data.access_token),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.log("index error",t.t0),alert("An error has ocurred, please contact the administrator");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}(),r=function(){var t=Object(d.a)(b.a.mark((function t(e){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p.a.get("https://coding-test.rootstack.net/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});case 3:n=t.sent,localStorage.setItem("user",JSON.stringify(n.data)),o.push("/jobs",a),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0),alert("An error has ocurred getting the logged user, please contact the administrator");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}(),j=function(t){c(Object(u.a)(Object(u.a)({},a),{},Object(l.a)({},t.target.name,t.target.value)))};return Object(h.jsxs)("div",{className:"login-container",children:[Object(h.jsx)("img",{className:"login-img",src:"#",alt:""}),Object(h.jsx)("label",{className:"login-label",htmlFor:"email",children:"Email:"}),Object(h.jsx)("input",{className:"login-textbox",type:"text",name:"email",id:"email",onChange:function(t){return j(t)}}),Object(h.jsx)("label",{className:"login-label",htmlFor:"password",children:"Password:"}),Object(h.jsx)("input",{className:"login-textbox",type:"password",name:"password",id:"password",onChange:function(t){return j(t)}}),Object(h.jsx)("input",{className:"login-button",type:"button",value:"Sign in now",onClick:s})]})},x=function(){var t=Object(i.f)();return Object(h.jsx)("div",{children:Object(h.jsx)("input",{className:"logout-button",type:"button",value:"Logout",onClick:function(e){return localStorage.removeItem("access_token"),localStorage.removeItem("user"),void t.push("/")}})})},f=function(){var t=Object(n.useState)({}),e=Object(g.a)(t,2),a=e[0],c=e[1];Object(n.useEffect)((function(){o()}),[]);var o=function(){if(null!==localStorage.getItem("user")){var t=JSON.parse(localStorage.getItem("user"));c(t)}};return Object(h.jsxs)("div",{className:"bar-status",children:[Object(h.jsxs)("div",{className:"logged-user",children:["Welcome ",a.name," (",a.email,")",Object(h.jsx)("img",{className:"button-location",alt:""})]}),Object(h.jsx)(x,{})]})},v=a(44),N=a(82),k=a(83),w=a(80),S=a(7),L=a.n(S),y=a.p+"static/media/icon.fdcd72ec.svg",A=L.a.icon({iconUrl:y,iconRetinaUrl:y,iconAnchor:null,shadowUrl:null,shadowSize:null,shadowAnchor:null,iconSize:[40,40],className:"leaflet-venue-icon"}),_=a(81),z=function(t){var e=t.job,a=e.title,n=e.image,c=e.latitude,o=e.longitude,s=e.assigned_to;return Object(h.jsx)(_.a,{children:Object(h.jsxs)("div",{className:"marker-popup",children:[Object(h.jsxs)("span",{className:"market-title",children:["Title: ",a]}),Object(h.jsxs)("span",{className:"market-title",children:["Assigned to: ",s]}),Object(h.jsx)("img",{className:"market-img",src:n,alt:a}),Object(h.jsxs)("span",{className:"market-title",children:["Lat: ",c]}),Object(h.jsxs)("span",{className:"market-title",children:["Lng: ",o]})]})})},I=function(t){return t.jobs.map((function(t){return Object(h.jsx)(w.a,{position:{lat:t.latitude,lng:t.longitude},icon:A,children:Object(h.jsx)(z,{job:t})},t.id)}))},J=(a(77),function(t){var e=t.jobs,a=t.coordinates,c=Object(n.useState)({currentLocation:{lat:"0",lng:"0"},zoom:13,allJobs:[]}),o=Object(g.a)(c,2),s=o[0],r=o[1],l=Object(i.g)();return Object(n.useEffect)((function(){if(l.state.latitude&&l.state.longitude){var t={lat:0===a.jobLatitude?l.state.latitude:a.jobLatitude,lng:0===a.jobLongitude?l.state.longitude:a.jobLongitude},n={assigned_to:"Logged user",created_at:"",date:"",description:"",id:0,image:"",latitude:t.lat,longitude:t.lng,status:"",title:"My location",updated_at:""},c=[].concat(Object(v.a)(e),[n]);r(Object(u.a)(Object(u.a)({},s),{},{currentLocation:t,allJobs:c}))}}),[e,a]),Object(h.jsxs)(N.a,{center:s.currentLocation,zoom:s.zoom,children:[Object(h.jsx)(k.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),Object(h.jsx)(I,{jobs:s.allJobs})]})}),C=function(){var t=Object(n.useState)([]),e=Object(g.a)(t,2),a=e[0],c=e[1],o=Object(n.useState)({jobLatitude:0,jobLongitude:0}),s=Object(g.a)(o,2),r=s[0],l=s[1],u=Object(i.f)();Object(n.useEffect)((function(){j(),m()}),[]);var j=function(){null===localStorage.getItem("access_token")&&(console.log("jobs isAuthorized"),u.push("/"))},m=function(){var t=Object(d.a)(b.a.mark((function t(){var e,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=localStorage.getItem("access_token"),t.next=4,p.a.get("https://coding-test.rootstack.net/api/jobs",{headers:{Authorization:"Bearer ".concat(e)}});case 4:a=t.sent,c(a.data.data),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),alert("An error has ocurred getting the jobs, please contact the administrator");case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}();return Object(h.jsxs)("div",{children:[Object(h.jsx)(f,{}),Object(h.jsxs)("div",{className:"job-container",children:[Object(h.jsx)("ul",{className:"jobs",children:a.map((function(t){return Object(h.jsxs)("div",{className:"job-item-button",children:[Object(h.jsxs)("li",{className:"job-item",children:[Object(h.jsx)("img",{className:"job-img",src:t.image,alt:t.title}),Object(h.jsx)("span",{className:"job-title",children:t.title})]},t.id),Object(h.jsx)("input",{className:"go-button",type:"button",value:"Go",onClick:function(){return e=t.latitude,a=t.longitude,void l({jobLatitude:e,jobLongitude:a});var e,a}})]})}))}),Object(h.jsx)(J,{jobs:a,coordinates:r})]})]})};var E=function(){return Object(h.jsx)("div",{className:"general-container",children:Object(h.jsx)(r.a,{basename:"/geolocation-app",children:Object(h.jsxs)(i.c,{children:[Object(h.jsx)(i.a,{exact:!0,path:"/jobs",component:C}),Object(h.jsx)(i.a,{exact:!0,path:"/",component:O})]})})})};a(78);s.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(E,{})}),document.getElementById("root"))}},[[79,1,2]]]);
//# sourceMappingURL=main.e9768f0b.chunk.js.map